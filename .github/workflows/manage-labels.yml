name: "Synchronisation des Labels sur Tous les Repos"

on:
  schedule:
    - cron: "0 0 * * 1"  # Ex√©cute chaque lundi √† minuit
  workflow_dispatch:

jobs:
  sync-labels:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v2

      - name: üìÇ V√©rifier la pr√©sence du fichier labels.yml
        run: |
          if [ ! -f .github/config/labels.yml ]; then
            echo "‚ùå labels.yml n'existe pas !"
            exit 1
          else
            echo "‚úÖ labels.yml trouv√© !"
          fi

      - name: Lister tous les repos et appliquer les labels
        env:
          GH_TOKEN: ${{ secrets.LABELGITHUB_TOKEN }}
        run: |
          echo "üîç R√©cup√©ration de la liste des repositories..."
          
          # R√©cup√©rer tous les repositories de l'utilisateur
          REPOS=$(gh api user/repos --paginate --jq '.[].full_name')

          # V√©rifier si la liste des repos est vide
          if [ -z "$REPOS" ]; then
            echo "‚ùå Aucun repository trouv√© !"
            exit 1
          fi

          # Appliquer les labels sur chaque repository en utilisant labels.yml
          echo "$REPOS" | while read -r repo; do
            echo "üìå Mise √† jour des labels pour $repo"
            gh api repos/$repo/labels \
              --method PUT \
              --input .github/config/labels.yml
          done
